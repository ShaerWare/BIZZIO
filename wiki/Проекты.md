# Проекты

Проект объединяет компании и пользователей для совместной работы. У проекта есть компания-владелец и компании-участники с разными ролями.

## Структура

### Участники-компании (company_project)

| Роль | Описание |
|------|----------|
| customer | Заказчик |
| general_contractor | Генподрядчик |
| contractor | Подрядчик |
| supplier | Поставщик |
| consultant | Консультант |

Дополнительные поля: participation_description, customer_review, customer_rating (1-5), participant_review, participant_rating (1-5).

### Участники-пользователи (project_user)

| Роль | Возможности |
|------|------------|
| admin | Полное управление проектом, участниками, комментариями |
| moderator | Управление комментариями, приглашение участников |
| member | Просмотр и комментирование |

Каждый пользователь привязан к компании (company_id в pivot).

## Статусы

| Статус | Описание |
|--------|----------|
| active | Активный проект |
| completed | Завершённый |
| cancelled | Отменённый |

## Комментарии

Вложенная (древовидная) структура через `parent_id`:

```
Comment (parent_id = null)
  └── Reply (parent_id = comment.id)
       └── Reply to reply (parent_id = reply.id)
```

Контроллер поддерживает AJAX-ответы для динамического обновления.

## Запросы на вступление в проект

```
pending → approved (пользователь добавляется в проект с указанной ролью)
        → rejected (с необязательным комментарием)
```

Подать запрос может любой авторизованный пользователь. Рассмотреть — admin или moderator проекта.

## Контроллер ProjectController

| Маршрут | Описание |
|---------|----------|
| GET /projects | Каталог с фильтрами (search, status, company) |
| GET /projects/create | Форма создания |
| POST /projects | Создание с участниками |
| GET /projects/{slug} | Страница проекта (вкладки: описание, участники, комментарии) |
| GET /projects/{slug}/edit | Редактирование |
| PUT /projects/{slug} | Обновление |
| DELETE /projects/{slug} | Удаление |
| POST /projects/{slug}/comments | Добавление комментария |

## Контроллер ProjectMemberController

| Маршрут | Описание |
|---------|----------|
| POST /projects/{slug}/members | Приглашение пользователя |
| PUT /projects/{slug}/members/{user} | Изменение роли |
| DELETE /projects/{slug}/members/{user} | Удаление участника |
| POST /projects/{slug}/join-requests | Подача запроса на вступление |
| POST /project-join-requests/{id}/approve | Одобрение запроса |
| POST /project-join-requests/{id}/reject | Отклонение запроса |
| DELETE /project-join-requests/{id} | Отмена своего запроса |

## Валидация (StoreProjectRequest)

- name: required, max 255
- description: nullable, max 500
- full_description: nullable
- avatar: nullable, image (jpeg/jpg/png/webp), max 2MB
- start_date: required, date
- end_date: nullable, date, after_or_equal:start_date
- is_ongoing: boolean
- status: required, in:active,completed,cancelled
- company_id: required, exists в companies + проверка что пользователь модератор этой компании
- participants.*.company_id: required, exists
- participants.*.role: required, in:customer,general_contractor,contractor,supplier,consultant
